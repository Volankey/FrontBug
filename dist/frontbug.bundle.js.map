{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/frontbug.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","window","FrontBug","device","u","navigator","userAgent","type","appVersion","ios","match","iPad","indexOf","android","iPhone","Mac","trident","presto","webKit","gecko","mobile","webApp","lists","keys","length","mobileType","version","browser","appname","toLowerCase","test","RegExp","$1","$2","appInfo","getObjectClass","obj","constructor","toString","str","charAt","arr","processStackMsg","error","stack","replace","split","slice","join","msg","config","reportTo","reportPreFix","reportKey","isConsole","reportImg","sampling","otherData","env","store","forEach","item","method","console","push","logs","arguments","apply","setConfig","log","assign","addHandler","fn","handler","addEventListener","e","onerror","reason","preventDefault","getSrc","emsg","url","line","col","errorType","substr","setting","src","Date","getTime","report","Math","random","img","Image","onload","ReferenceError","default","message","Event","isPrototypeOf","target","tagName","undefined","document","elem","createElement","el","crossOrigin","OXMLHttpRequest","XMLHttpRequest","xhr","count","Oopen","open","Osend","send","async","requestUrl","sendStart","hs","this","readyState","sendEnd","loadTime","status","mes","statusText","responseURL","removeEventListener","callback","he","location","href","init"],"mappings":"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","file":"frontbug.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","(function (obj, init) {\n    obj[\"FrontBug\"] = init();\n}(window, function () {\n    var FrontBug = {},\n        device = mobileType(),\n        version = appInfo();\n    //初始配置\n    FrontBug.config = {\n        reportTo: null,//上报地址\n        reportPreFix: \"\",//前缀\n        reportKey: \"frontbug\",//key\n        isConsole: true,//输出到控制台\n        reportImg:true,//上报image错误\n        sampling:0.3, //采样率\n        otherData: {\n            device: device,\n            env: version,\n        }\n    }\n    //输出列表\n    FrontBug.store = [];\n\n    var methodList = ['log', 'info', 'warn', 'debug', 'error'];\n    //装饰console.xx功能,添加到store\n    methodList.forEach(function (item) {\n        //之前的\n        var method = console[item];\n\n        //现在的\n        console[item] = function () {\n            FrontBug.store.push({\n                type: item,\n                logs: arguments\n            })\n            method.apply(console, arguments);\n        }\n\n    })\n    //设置配置\n    FrontBug.setConfig = function (config) {\n        console.log(config);\n        FrontBug.config = Object.assign(FrontBug.config, config);\n    }\n    FrontBug.addHandler = function (name, fn) {\n        handler[name] = fn;\n    }\n    FrontBug.processStackMsg = function (msg) {\n        return processStackMsg(msg)\n    }\n\n\n    //获取设备\n    function mobileType() {\n        var u = navigator.userAgent,\n            app = navigator.appVersion;\n        var type = { // 移动终端浏览器版本信息\n            ios: !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端\n            iPad: u.indexOf('iPad') > -1, //是否iPad\n            android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器\n            iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器\n            Mac:u.indexOf('Mac') > -1,\n            trident: u.indexOf('Trident') > -1, //IE内核\n            presto: u.indexOf('Presto') > -1, //opera内核\n            webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核\n            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核\n            mobile: !!u.match(/AppleWebKit.*Mobile/i) || !!u.match(\n                /MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/\n            ), //是否为移动终端\n            webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部\n        };\n\n        var lists = Object.keys(type);\n        for (var i = 0; i < lists.length; i++) {\n            if (type[lists[i]]) {\n                return lists[i];\n            }\n        }\n    }\n\n    function getObjectClass(obj) {\n        if (obj && obj.constructor && obj.constructor.toString()) {\n            //获取构造函数名称\n            if (obj.constructor.name) {\n                return obj.constructor.name;\n            }\n            var str = obj.constructor.toString();\n\n            if (str.charAt(0) == '[') {\n                //常规\n                var arr = str.match(/\\[\\w+\\s*(\\w+)\\]/);\n            } else {\n                //ie firefox\n                var arr = str.match(/function\\s*(\\w+)/);\n            }\n            if (arr && arr.length == 2) {\n                return arr[1];\n            }\n        }\n        return undefined;\n    };\n\n    //promise错误\n    window.addEventListener(\"unhandledrejection\", function (e) {\n        // Event新增属性\n        // @prop {Promise} promise - 状态为rejected的Promise实例\n        // @prop {String|Object} reason - 异常信息或rejected的内容\n\n        // 会阻止异常继续抛出，不让Uncaught(in promise) Error产生\n        console.log(e);\n        window.onerror(e, e.reason.value, 0, 0, e)\n\n\n        e.preventDefault()\n    });\n    // 获取当前浏览器名 及 版本号\n    function appInfo() {\n        var browser = {\n                appname: 'unknown',\n                version: 0\n            },\n            userAgent = window.navigator.userAgent.toLowerCase(); // 使用navigator.userAgent来判断浏览器类型\n        //msie,firefox,opera,chrome,netscape  \n        if (/(msie|firefox|opera|chrome|netscape)\\D+(\\d[\\d.]*)/.test(userAgent)) {\n            browser.appname = RegExp.$1;\n            browser.version = RegExp.$2;\n        } else if (/version\\D+(\\d[\\d.]*).*safari/.test(userAgent)) { // safari  \n            browser.appname = 'safari';\n            browser.version = RegExp.$2;\n        }\n        return browser.appname + \":\" + browser.version;\n    }\n\n    function processStackMsg(error) {\n        var stack = error.stack\n            .replace(/\\n/gi, \"\") //换行符\n            .split(/\\bat\\b/) //分割为数组\n            .slice(0, 9) //最多取9个\n            .join(\"@\") //@分割每一个\n            .replace(/\\?[^:]+/gi, \"\") //替换问号\n\n        var msg = error.toString()\n        if (stack.indexOf(msg) < 0) {\n            stack = msg + \"@\" + stack\n        }\n        return stack\n    }\n    var handler = {};\n\n    handler.ReferenceError = handler.default = function (error, msg) {\n        var message = msg;\n        var emsg = \"\";\n        if(typeof msg === \"string\"){\n            emsg += msg;\n        }\n        if (error && error.stack) {\n            emsg = processStackMsg(error)\n        }\n        // 判断是否是Event触发了错误\n        if (Event.prototype.isPrototypeOf(message)) {\n            emsg += (message.type?\"--\"+message.type+\"--\"+(message.target?(message.target.tagName+\"::\"+message.target.src):\"\"):\"\");\n            // emsg +=\n            //     `${message.type?\"\"+message.type+message.target?message.target.tagName+\"::\"+ message.target.src:\"\":\"\"}`;\n        }\n       \n        return emsg;\n    }\n\n    function getSrc(emsg,url,line,col,errorType) {\n        //防止过大\n        emsg = (emsg + \"\" || \"\").substr(0, 500);\n\n        var setting = FrontBug.config;\n\n        if (setting.reportTo) {\n            var src = setting.reportTo;\n            src += setting.reportTo.indexOf(\"?\") > -1 ? \"&\" : \"?\" + setting.reportKey + \"=\" + (\n                setting.reportPreFix ? \"[\" + setting.reportPreFix + \"]\" : \"\") + emsg;\n            //拼接额外data\n            Object.keys(setting.otherData).forEach(function (key) {\n                src += \"&\" + key + \"=\" + setting.otherData[key];\n            })\n            src += \"&t=\" + new Date().getTime();\n            src += \"&url=\" + url;\n            src += \"&l=\" + line;\n            src += \"&c=\" + col;\n            src += \"&e=\" + errorType;\n            // console.log(src)\n            //提交report\n            return src;\n        }\n    }\n    window.onerror = function (msg, url, line, col, error) {\n        console.log(getObjectClass(error));\n        var errorType = getObjectClass(error);\n\n        if (handler[errorType] == undefined) {\n            console.log(\"默认\");\n            \n            report(getSrc(handler.default(error, msg), url, line, col,errorType));\n\n        } else {\n            report(getSrc(handler[errorType](error, msg), url, line, col,errorType));\n        }\n        return FrontBug.config.isConsole;\n    }\n\n    function report(src) {\n        // 只采集 30%\n        if(Math.random() < FrontBug.config.sampling) {\n            if (!src)\n                return;\n            var img = new Image();\n            img.src = src;\n            img.onload = function () {\n                img = null;\n            }\n        }\n       \n    }\n    //添加一个PromiseRejectionEvent处理 需返回一个错误信息的字符串！\n    FrontBug.addHandler(\"PromiseRejectionEvent\", function (error, msg) {\n        console.log(error);\n        return FrontBug.processStackMsg(error.reason)\n    })\n\n    //监听图片加载失败 事件捕获阶段\n    FrontBug.config.reportImg && document.addEventListener(\"error\", function (e) {\n        var elem = e.target;\n        if (elem.tagName.toLowerCase() == \"img\") {\n            window.onerror(e,elem.src,0,0,e);\n        }\n    },true);\n\n    //劫持document.createElement 为script添加result.crossOrigin\n    //同时您需要在服务端配置Access-Control-Allow-Origin 允许静态资源的源\n    var createElement = document.createElement;\n    document.createElement = function(type){\n        var el = createElement.call(document,type);\n        if(type.toLowerCase() === \"script\"){\n            el.crossOrigin = \"anonymous\";\n        }\n        return el;\n    }\n    //TODO:劫持xhr\n    var OXMLHttpRequest = XMLHttpRequest;\n    XMLHttpRequest = function _XMLHttpRequest(){\n        // OXMLHttpRequest.call(this);\n        var xhr = new OXMLHttpRequest();\n        \n        xhr.count = 0;\n        var Oopen = xhr.open,\n            Osend = xhr.send;\n        xhr.open  = function (method,url,async=true){\n            xhr.requestUrl = url;\n            xhr.method = method;\n            Oopen.call(xhr,method,url,async);\n        }\n        xhr.send = function (){\n            xhr.sendStart = new Date().getTime();\n            Osend.apply(xhr,arguments);\n        }\n        \n        //绑定当前xhr\n        function hs(e){\n            handleStatus.call(xhr,hs,e);\n        }\n        function he(e){\n            return handleError.call(xhr,he,e);\n        }\n\n        xhr.addEventListener(\"readystatechange\",hs);\n        xhr.addEventListener(\"error\",he);\n        \n        return xhr;\n    }\n    function handleError(callback,e){\n        var xhr = this;\n       \n        xhr.count = 1;\n    \n        var mes = \"XHR ERROR \"+window.location.href+\" request to \"+xhr.requestUrl+\":\"+xhr.method;\n        // var e = new Error(mes);\n        window.onerror(mes,xhr.requestUrl,0,0,e);\n        xhr.removeEventListener(\"error\",callback);\n        xhr = null;\n        \n    }\n    function handleStatus(){\n        var xhr = this;\n        if(xhr.readyState == 4){\n            xhr.sendEnd = new Date().getTime();\n            xhr.loadTime = xhr.sendEnd - xhr.sendStart;\n        }\n        if((xhr.status >= 400) && xhr.count == 0){\n            xhr.count = 1;\n            xhr.sendEnd = new Date().getTime();\n            xhr.loadTime = xhr.sendEnd - xhr.sendStart;\n            var mes = \"\"+xhr.status+\":\"+xhr.statusText+\" loadtime=\"+xhr.loadTime+\" @ \"+xhr.responseURL;\n            window.onerror(mes,xhr.responseURL,0,0,xhr);\n            xhr.removeEventListener(\"readystatechange\",callback);\n            xhr = null;\n        }\n    }\n    return FrontBug;\n}))\n\n"],"sourceRoot":""}